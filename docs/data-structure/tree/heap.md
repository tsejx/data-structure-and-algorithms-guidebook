---
nav:
  title: æ•°æ®ç»“æ„
  order: 1
group:
  title: æ ‘
  order: 7
title: å †
order: 20
---

# å †

**å †**ï¼ˆHeapï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ä¸€ç±»ç‰¹æ®Šçš„æ•°æ®ç»“æ„çš„ç»Ÿç§°ã€‚å †é€šå¸¸æ˜¯ä¸€ä¸ªå¯ä»¥è¢«çœ‹åšä¸€æ£µæ ‘çš„æ•°ç»„å¯¹è±¡ã€‚å †æ€»æ˜¯æ»¡è¶³ä¸‹åˆ—æ€§è´¨ï¼š

- å †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å·¦å³å­èŠ‚ç‚¹çš„å€¼
- å †æ€»æ˜¯ä¸€æ£µ `å®Œå…¨äºŒå‰æ ‘`

## äºŒå‰å †

äºŒå‰å †æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼ŒäºŒå‰å †åˆ†ä¸ºå¤§é¡¶å †ï¼ˆæœ€å¤§å †ï¼‰å’Œå°é¡¶å †ï¼ˆæœ€å°å †ï¼‰ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«ä½œ `å¤§é¡¶å †`ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«ä½œ `å°é¡¶å †`ã€‚

æ€§è´¨ï¼š

- ä»»ä½•ä¸€ä¸ªéæ ‘æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸º `Math.floor((index - 1) / 2)`
- ä»»ä½•ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¸º `index * 2 + 1`
- ä»»ä½•ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ä¸º `index * 2 + 2`

```jsx | inline
import React from 'react';
import img from '../../assets/heap/max-heap-and-min-heap.png';

export default () => <img alt="å¤§é¡¶å †å’Œå°é¡¶å †" src={img} width="50%" height="50%" />;
```

## å †çš„å®ç°

è¦å®ç°å †ï¼Œæˆ‘ä»¬è¦å…ˆçŸ¥é“ï¼Œå †éƒ½æ”¯æŒå“ªäº›æ“ä½œä»¥åŠå¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †ï¼š

1. ä¸Šæµ® heapifyUp
2. ä¸‹æ²‰ heapifyDown
3. æ’å…¥ Insert
4. å¼¹å‡º
5. å–é¡¶ ExtractMax
6. å †æ’åº

åœ¨å †çš„å®ç°æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼š

- å› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥çˆ¶å­èŠ‚ç‚¹çš„å…³ç³»å°±ä¸éœ€è¦ç‰¹æ®Šçš„ç»“æ„å»ç»´æŠ¤äº†ï¼Œç´¢å¼•ä¹‹é—´é€šè¿‡è®¡ç®—å°±å¯ä»¥å¾—åˆ°ï¼Œçœæ‰äº†å¾ˆå¤šéº»çƒ¦ã€‚å¦‚æœæ˜¯é“¾è¡¨ç»“æ„ï¼Œå°±ä¼šå¤æ‚å¾ˆå¤š
- å®Œå…¨äºŒå‰æ ‘è¦æ±‚å¶å­èŠ‚ç‚¹ä»å·¦å¾€å³å¡«æ»¡ï¼Œæ‰èƒ½å¼€å§‹å¡«å……ä¸‹ä¸€å±‚ï¼Œè¿™å°±ä¿è¯äº†ä¸éœ€è¦å¯¹æ•°ç»„æ•´ä½“è¿›è¡Œå¤§ç‰‡çš„ç§»åŠ¨ã€‚è¿™ä¹Ÿæ˜¯éšæœºå­˜å‚¨ç»“æ„ï¼ˆæ•°ç»„ï¼‰çš„çŸ­æ¿ï¼šåˆ é™¤ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œæ•´ä½“å¾€å‰ç§»æ˜¯æ¯”è¾ƒè´¹æ—¶çš„ã€‚è¿™ä¸ªç‰¹æ€§é¡µå¯¼è‡´å †åœ¨åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œè¦æŠŠæœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹è¡¥å……åˆ°æ ‘æ ¹èŠ‚ç‚¹çš„ç¼˜ç”±

### å †åŒ–

æŠŠæ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°å †çš„æœ€åï¼Œç„¶åæ£€æµ‹æ˜¯å¦æ»¡è¶³å †çš„æ€§è´¨ã€‚å¦‚æœä¸æ»¡è¶³åˆ™éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º **å †åŒ–**ï¼ˆHeapifyï¼‰ã€‚

å †åŒ–å®é™…ä¸Šæœ‰ä¸¤ç§ï¼Œä»ä¸‹å¾€ä¸Šå’Œä»ä¸Šå¾€ä¸‹ã€‚

å †åŒ–éå¸¸ç®€å•ï¼Œå°±æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨çš„è·¯å¾„ï¼Œå‘ä¸Šæˆ–è€…å‘ä¸‹ï¼Œå¯¹æ¯”ï¼Œç„¶åäº¤æ¢ã€‚

```jsx | inline
import React from 'react';
import img from '../../assets/heap/heapify.jpg';

export default () => <img alt="å †åŒ–" src={img} width="50%" height="50%" />;
```

### ä»£ç å®ç°

è¿™é‡Œæˆ‘ä»¬ä»¥å®ç°æœ€å¤§å †ä¸ºä¾‹ï¼š

```js
// å †å…ƒç´ ç´¢å¼•ä» 1 å¼€å§‹ï¼Œåˆå§‹åŒ–æ—¶å…ˆå°†ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ä¸º 0
// å †æœ‰ n ä¸ªå…ƒç´ ï¼Œåˆ™å®ƒçš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹æ˜¯ç¬¬ n/2 + 1 ä¸ªï¼Œæœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹æ˜¯ç¬¬ n/2 ä¸ª
// å°† n ä¸ªå…ƒç´ é€ä¸ªæ’å…¥åˆ°ä¸€ä¸ªç©ºå †ä¸­ï¼Œç®—æ³•å¤æ‚åº¦ä¸º O(n log n)
function MaxHeap(arr = []) {
  this.data = [...arr];

  // heapify æ–¹å¼åˆ›å»ºå †ç»“æ„
  // åˆ©ç”¨å †çš„ç¬¬ n/2 ä¸ªå…ƒç´ æ˜¯æœ€åä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„å…ƒç´ 
  // ä»æœ€åä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„å…ƒç´ å¼€å§‹å‘ä¸Šå¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œå †é‡æ„
  for (let i = this.parent(arr.length - 1); i >= 0; i--) {
    this.heapifyDown(i);
  }
}

MaxHeap.prototype.size = function() {
  return this.data.length;
};

MaxHeap.prototype.isEmpty = function() {
  return !this.data.length;
};

MaxHeap.prototype.parent = function(index) {
  if (index === 0) {
    throw new Error(`index-0 does't not have parent`);
  }

  return Math.floor((this.data.length - 1) / 2);
};

MaxHeap.prototype.leftChildIndex = function(index) {
  return index * 2 + 1;
};

MaxHeap.prototype.rightChildIndex = function(index) {
  return index * 2 + 2;
};

// å‘å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼šæ’å…¥åˆ°æœ€åä¸€ä¸ªä½ç½®ï¼Œå †æ’å…¥çš„å…ƒç´ å‘ä¸Šè¿›è¡Œå †é‡æ„
MaxHeap.prototype.insert = function(value) {
  this.data.push(value);

  // å°†æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œä¸Šæµ®æ“ä½œ
  this.heapifyUp(this.data.length - 1);
};

MaxHeap.prototype.findMax = function() {
  if (this.size() === 0) {
    throw new Error('Heap is empty');
  }

  // å¤§é¡¶å †ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æœ€å¤§çš„å€¼
  return this.data[0];
};

// åˆ é™¤å †ä¸­çš„æœ€å¤§å…ƒç´ ï¼šå°†æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°ç¬¬ä¸€çš„ä½ç½®ï¼Œå‘ä¸‹è¿›è¡Œå †é‡æ„
Heap.prototype.extractMax = function() {
  const maxValue = this.findMax();
  // å †é¦–å°¾å…ƒç´ äº¤æ¢
  this.swap(0, this.data.length - 1);
  // åˆ é™¤å·²ç»ä½äºå †å°¾çš„æœ€å¤§å€¼å…ƒç´ 
  this.data.pop();
  // å‘ä¸‹å †é‡æ„
  this.heapifyDown(0);

  return maxValue;
};

// å‘ä¸Šå †é‡æ„ï¼šæ–°å…ƒç´ ä¸çˆ¶å…ƒç´ æ¯”è¾ƒï¼Œæ–°å…ƒç´ å¤§åˆ™äº¤æ¢ï¼ŒçŸ¥é“æ–°å…ƒç´ æ¯”çˆ¶å…ƒç´ å°ä¸ºæ­¢
Heap.prototype.heapifyUp = function(index) {
  while (index > 0 && this.data[this.parent(index)] < this.data[index]) {
    // äº¤æ¢æ•°ç»„ä¸­ä½ç½®
    this.swap(index, this.parent(index));
    // æ˜¯ä¸æ˜¯ä¾ç„¶ä¸æ»¡è¶³å †çš„æ€§è´¨
    index = this.parent(index);
  }
};

// å‘ä¸‹å †é‡æ„ï¼šä»å †é¡¶å¼€å§‹ï¼Œæ¯”è¾ƒå½“å‰å…ƒç´ å’Œä¸¤ä¸ªå­å…ƒç´ ï¼Œå°†è‹¥å½“å‰å…ƒç´ å°äºå­å…ƒç´ ä¸­çš„ä¸€ä¸ªï¼Œåˆ™å°†å½“å‰å…ƒç´ ä¸è¾ƒå¤§çš„å­å…ƒç´ äº¤æ¢ï¼ŒçŸ¥é“å½“å‰å…ƒç´ å¤§äºå…¶å­å…ƒç´ 
Heap.prototype.heapifyDown = function(index) {
  while (this.leftChildIndex(index) < this.data.length) {
    let leftChildIndex = this.leftChildIndex(index);

    // æç«¯æƒ…å†µï¼šå½“å·¦å­èŠ‚ç‚¹ç´¢å¼•å°äºæ•°ç»„é•¿åº¦æ—¶ä»£è¡¨ç»å¯¹æ²¡æœ‰å³å­èŠ‚ç‚¹ï¼Œæ˜¯å¶å­èŠ‚ç‚¹
    if (
      leftChildIndex + 1 < this.data.length &&
      this.data[leftChildIndex + 1] > this.data[leftChildIndex]
    ) {
      leftChildIndex = this.rightChildIndex(index);
    }

    if (this.data[index] > this.data[leftChildIndex]) {
      // æ»¡è¶³å †çš„æ€§è´¨ç›´æ¥æŒ‘å‡º
      break;
    } else {
      // å¦åˆ™ç»§ç»­äº¤æ¢
      this.swap(index, leftChildIndex);
      index = leftChildIndex;
    }
  }
};

// å †æ•°ç»„ä½ç½®äº¤æ¢
Heap.prototype.swap = function(i, j) {
  if (i < 0 || i >= this.data.length || j < 0 || j >= this.data.length) {
    throw new Error('Index is out of range');
  }

  return ([this.data[i], this.data[j]] = [this.data[j], this.data[i]]);
};
```

æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªåŒ…å« `n` ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ `log2â€‹n`ã€‚å †åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„æ¯”è¾ƒäº¤æ¢çš„ï¼Œæ‰€ä»¥å †åŒ–çš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ `O(logn)`ã€‚æ’å…¥æ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„ä¸»è¦é€»è¾‘å°±æ˜¯å †åŒ–ï¼Œæ‰€ä»¥ï¼Œå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ `O(logn)`ã€‚

## å †çš„åº”ç”¨

- äºŒé¡¹å †ï¼ˆBinomial Heapï¼‰
- æ–æ³¢é‚£å¥‘å †ï¼ˆFibonacci Heapï¼‰
- é…å¯¹å †ï¼ˆPairing Heapï¼‰
- å·¦åæ ‘/å †ï¼ˆLeftist Heapï¼‰

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ›  å¯è§†åŒ–æ•°æ®ç»“æ„ - å †](https://visualgo.net/zh/heap)
- [ğŸ“ å‰ç«¯å­¦æ•°æ®ç»“æ„ - å †ï¼ˆHeapï¼‰](https://boycgit.github.io/ss-heap/)
- [ğŸ“ ä» libuv æºç ä¸­å­¦ä¹ æœ€å°äºŒå‰å †](https://zhuanlan.zhihu.com/p/91715665)
